<!DOCTYPE html>
<html>
    <head>
        <title>React</title>
        <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
        <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
        <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
        <style>
            /* Reset and base styles */
            * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            }

            body {
            background-color: #f5f5f5;
            color: #333;
            line-height: 1.6;
            }

            .yasa-news {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            }

            /* Header styles */
            .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
            border-bottom: 1px solid #ddd;
            margin-bottom: 20px;
            }

            .header h1 {
            color: #2c3e50;
            font-size: 2rem;
            }

            .search-bar input {
            padding: 8px 15px;
            width: 300px;
            border: 1px solid #ddd;
            border-radius: 20px;
            font-size: 1rem;
            }

            .auth-section button {
            padding: 8px 15px;
            background-color: #4285f4;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
            }

            .auth-section button:hover {
            background-color: #3367d6;
            }

            .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
            }

            .user-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            }

            /* Filter buttons */
            .filter-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            }

            .filter-buttons button {
            padding: 8px 15px;
            background-color: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
            }

            .filter-buttons button.active {
            background-color: #4285f4;
            color: white;
            border-color: #4285f4;
            }

            /* Articles list */
            .articles-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            }

            .article-card {
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            transition: transform 0.2s;
            }

            .article-card:hover {
            transform: translateY(-5px);
            }

            .article-thumbnail {
            width: 100%;
            height: 180px;
            object-fit: cover;
            cursor: pointer;
            }

            .article-info {
            padding: 15px;
            }

            .article-info h3 {
            margin-bottom: 10px;
            cursor: pointer;
            color: #2c3e50;
            }

            .article-info h3:hover {
            color: #4285f4;
            }

            .article-excerpt {
            color: #666;
            margin-bottom: 10px;
            font-size: 0.9rem;
            }

            .article-meta {
            display: flex;
            gap: 10px;
            font-size: 0.8rem;
            color: #888;
            margin-bottom: 10px;
            }

            .article-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            }

            .tag {
            background-color: #e0e0e0;
            padding: 3px 8px;
            border-radius: 10px;
            font-size: 0.7rem;
            color: #555;
            }

            /* Article detail */
            .article-detail {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            }

            .back-button {
            background: none;
            border: none;
            color: #4285f4;
            cursor: pointer;
            margin-bottom: 15px;
            font-size: 1rem;
            }

            .article-detail h2 {
            color: #2c3e50;
            margin-bottom: 10px;
            }

            .article-detail .article-thumbnail {
            max-height: 400px;
            margin-bottom: 15px;
            }

            .article-detail .article-meta {
            margin-bottom: 20px;
            }

            .article-content {
            margin-bottom: 20px;
            line-height: 1.8;
            }

            .article-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            }

            .article-actions button {
            padding: 8px 15px;
            background-color: #4285f4;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            }

            .article-actions .delete-button {
            background-color: #dc3545;
            }

            /* Admin panel */
            .admin-panel {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            }

            .admin-panel form div {
            margin-bottom: 15px;
            }

            .admin-panel label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            }

            .admin-panel input,
            .admin-panel textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            }

            .admin-panel textarea {
            min-height: 150px;
            }

            /* Loading and no articles */
            .loading,
            .no-articles {
            text-align: center;
            padding: 50px;
            font-size: 1.2rem;
            color: #666;
            }
        </style>
    </head>
    <body>
        <script>
            import React, { useState, useEffect } from 'react';
            import { initializeApp } from 'firebase/app';
            import { getFirestore, collection, getDocs, doc, getDoc, updateDoc, addDoc, deleteDoc, query, where, orderBy } from 'firebase/firestore';
            import { getAuth, GoogleAuthProvider, signInWithPopup, signOut } from 'firebase/auth';

            // Firebase configuration
            const firebaseConfig = {
                apiKey: "AIzaSyAGS_00EGf85mU36rN6_J_3JEAsxvMzn5g",
                authDomain: "universal-databases.firebaseapp.com",
                projectId: "universal-databases",
                storageBucket: "universal-databases.firebasestorage.app",
                messagingSenderId: "238780443230",
                appId: "1:238780443230:web:2286f232844108e53de2cf",
                measurementId: "G-8TL3PKL1WL"
            };

            // Initialize Firebase
            const app = initializeApp(firebaseConfig);
            const db = getFirestore(app);
            const auth = getAuth(app);
            const provider = new GoogleAuthProvider();

            // ADMIN UID (replace with your actual UID)
            const ADMIN_UID = "YOUR_ADMIN_UID";

            const YasaNews = () => {
            const [articles, setArticles] = useState([]);
            const [filteredArticles, setFilteredArticles] = useState([]);
            const [currentArticle, setCurrentArticle] = useState(null);
            const [user, setUser] = useState(null);
            const [loading, setLoading] = useState(true);
            const [filter, setFilter] = useState('all');
            const [searchTerm, setSearchTerm] = useState('');
            const [isAdmin, setIsAdmin] = useState(false);
            const [showAdminPanel, setShowAdminPanel] = useState(false);
            const [newArticle, setNewArticle] = useState({
                title: '',
                content: '',
                tags: [],
                thumbnail: ''
            });

            // Fetch articles from Firestore
            const fetchArticles = async () => {
                setLoading(true);
                try {
                let articlesQuery;
                
                if (filter === 'hot') {
                    articlesQuery = query(collection(db, 'articles'), orderBy('likes', 'desc'));
                } else if (filter === 'new') {
                    articlesQuery = query(collection(db, 'articles'), orderBy('createdAt', 'desc'));
                } else {
                    articlesQuery = collection(db, 'articles');
                }
                
                const querySnapshot = await getDocs(articlesQuery);
                const articlesData = querySnapshot.docs.map(doc => ({
                    id: doc.id,
                    ...doc.data()
                }));
                
                setArticles(articlesData);
                setFilteredArticles(articlesData);
                } catch (error) {
                console.error("Error fetching articles: ", error);
                } finally {
                setLoading(false);
                }
            };

            // Handle article click
            const handleArticleClick = async (articleId) => {
                try {
                const docRef = doc(db, 'articles', articleId);
                const docSnap = await getDoc(docRef);
                
                if (docSnap.exists()) {
                    setCurrentArticle({
                    id: docSnap.id,
                    ...docSnap.data()
                    });
                    
                    // Increment read count
                    await updateDoc(docRef, {
                    reads: (docSnap.data().reads || 0) + 1
                    });
                }
                } catch (error) {
                console.error("Error fetching article: ", error);
                }
            };

            // Handle like
            const handleLike = async (articleId) => {
                if (!user) return;
                
                try {
                const docRef = doc(db, 'articles', articleId);
                const docSnap = await getDoc(docRef);
                
                if (docSnap.exists()) {
                    const currentLikes = docSnap.data().likes || 0;
                    await updateDoc(docRef, {
                    likes: currentLikes + 1
                    });
                    
                    // Update local state
                    if (currentArticle && currentArticle.id === articleId) {
                    setCurrentArticle({
                        ...currentArticle,
                        likes: currentLikes + 1
                    });
                    }
                    
                    // Refresh articles list
                    fetchArticles();
                }
                } catch (error) {
                console.error("Error liking article: ", error);
                }
            };

            // Handle search
            const handleSearch = (e) => {
                const term = e.target.value.toLowerCase();
                setSearchTerm(term);
                
                if (term === '') {
                setFilteredArticles(articles);
                } else {
                const filtered = articles.filter(article => 
                    article.title.toLowerCase().includes(term) || 
                    article.content.toLowerCase().includes(term) ||
                    article.tags?.some(tag => tag.toLowerCase().includes(term))
                );
                setFilteredArticles(filtered);
                }
            };

            // Handle filter change
            const handleFilterChange = (newFilter) => {
                setFilter(newFilter);
                fetchArticles();
            };

            // Google sign in
            const handleGoogleSignIn = async () => {
                try {
                const result = await signInWithPopup(auth, provider);
                const user = result.user;
                setUser(user);
                setIsAdmin(user.uid === ADMIN_UID);
                } catch (error) {
                console.error("Error signing in: ", error);
                }
            };

            // Sign out
            const handleSignOut = async () => {
                try {
                await signOut(auth);
                setUser(null);
                setIsAdmin(false);
                setShowAdminPanel(false);
                } catch (error) {
                console.error("Error signing out: ", error);
                }
            };

            // Handle new article form change
            const handleNewArticleChange = (e) => {
                const { name, value } = e.target;
                setNewArticle(prev => ({
                ...prev,
                [name]: value
                }));
            };

            // Handle tags input
            const handleTagsChange = (e) => {
                const tags = e.target.value.split(',').map(tag => tag.trim());
                setNewArticle(prev => ({
                ...prev,
                tags
                }));
            };

            // Submit new article
            const handleSubmitArticle = async (e) => {
                e.preventDefault();
                try {
                await addDoc(collection(db, 'articles'), {
                    title: newArticle.title,
                    content: newArticle.content,
                    tags: newArticle.tags,
                    thumbnail: newArticle.thumbnail,
                    likes: 0,
                    reads: 0,
                    createdAt: new Date().toISOString(),
                    author: user.displayName || user.email
                });
                
                setNewArticle({
                    title: '',
                    content: '',
                    tags: [],
                    thumbnail: ''
                });
                
                fetchArticles();
                setShowAdminPanel(false);
                } catch (error) {
                console.error("Error adding article: ", error);
                }
            };

            // Delete article
            const handleDeleteArticle = async (articleId) => {
                try {
                await deleteDoc(doc(db, 'articles', articleId));
                fetchArticles();
                if (currentArticle && currentArticle.id === articleId) {
                    setCurrentArticle(null);
                }
                } catch (error) {
                console.error("Error deleting article: ", error);
                }
            };

            // Auth state listener
            useEffect(() => {
                const unsubscribe = auth.onAuthStateChanged((user) => {
                setUser(user);
                setIsAdmin(user?.uid === ADMIN_UID);
                setLoading(false);
                });
                
                return () => unsubscribe();
            }, []);

            // Fetch articles on component mount
            useEffect(() => {
                fetchArticles();
            }, []);

            if (loading && !user) {
                return <div className="loading">Loading...</div>;
            }

            return (
                <div className="yasa-news">
                <header className="header">
                    <h1>YasaNews</h1>
                    <div className="search-bar">
                    <input
                        type="text"
                        placeholder="Search articles..."
                        value={searchTerm}
                        onChange={handleSearch}
                    />
                    </div>
                    <div className="auth-section">
                    {user ? (
                        <div className="user-info">
                        <img src={user.photoURL} alt={user.displayName} className="user-avatar" />
                        <span>{user.displayName || user.email}</span>
                        {isAdmin && (
                            <button onClick={() => setShowAdminPanel(!showAdminPanel)}>
                            {showAdminPanel ? 'Hide Admin' : 'Admin Panel'}
                            </button>
                        )}
                        <button onClick={handleSignOut}>Sign Out</button>
                        </div>
                    ) : (
                        <button onClick={handleGoogleSignIn}>Sign in with Google</button>
                    )}
                    </div>
                </header>

                {showAdminPanel && isAdmin && (
                    <div className="admin-panel">
                    <h2>Admin Panel</h2>
                    <form onSubmit={handleSubmitArticle}>
                        <h3>Add New Article</h3>
                        <div>
                        <label>Title:</label>
                        <input
                            type="text"
                            name="title"
                            value={newArticle.title}
                            onChange={handleNewArticleChange}
                            required
                        />
                        </div>
                        <div>
                        <label>Content:</label>
                        <textarea
                            name="content"
                            value={newArticle.content}
                            onChange={handleNewArticleChange}
                            required
                        />
                        </div>
                        <div>
                        <label>Tags (comma separated):</label>
                        <input
                            type="text"
                            name="tags"
                            onChange={handleTagsChange}
                        />
                        </div>
                        <div>
                        <label>Thumbnail URL:</label>
                        <input
                            type="text"
                            name="thumbnail"
                            value={newArticle.thumbnail}
                            onChange={handleNewArticleChange}
                        />
                        </div>
                        <button type="submit">Publish Article</button>
                    </form>
                    </div>
                )}

                <div className="filter-buttons">
                    <button onClick={() => handleFilterChange('all')} className={filter === 'all' ? 'active' : ''}>
                    All Articles
                    </button>
                    <button onClick={() => handleFilterChange('hot')} className={filter === 'hot' ? 'active' : ''}>
                    Hot Articles
                    </button>
                    <button onClick={() => handleFilterChange('new')} className={filter === 'new' ? 'active' : ''}>
                    New Articles
                    </button>
                </div>

                {currentArticle ? (
                    <div className="article-detail">
                    <button onClick={() => setCurrentArticle(null)} className="back-button">
                        ← Back to articles
                    </button>
                    <h2>{currentArticle.title}</h2>
                    {currentArticle.thumbnail && (
                        <img src={currentArticle.thumbnail} alt={currentArticle.title} className="article-thumbnail" />
                    )}
                    <div className="article-meta">
                        <span>By {currentArticle.author}</span>
                        <span>Published on {new Date(currentArticle.createdAt).toLocaleDateString()}</span>
                        <span>{currentArticle.reads || 0} reads</span>
                    </div>
                    <div className="article-content">
                        {currentArticle.content}
                    </div>
                    <div className="article-tags">
                        {currentArticle.tags?.map((tag, index) => (
                        <span key={index} className="tag">{tag}</span>
                        ))}
                    </div>
                    <div className="article-actions">
                        <button onClick={() => handleLike(currentArticle.id)}>
                        👍 Like ({currentArticle.likes || 0})
                        </button>
                        {isAdmin && (
                        <button 
                            onClick={() => handleDeleteArticle(currentArticle.id)}
                            className="delete-button"
                        >
                            Delete Article
                        </button>
                        )}
                    </div>
                    </div>
                ) : (
                    <div className="articles-list">
                    {filteredArticles.length > 0 ? (
                        filteredArticles.map(article => (
                        <div key={article.id} className="article-card">
                            {article.thumbnail && (
                            <img 
                                src={article.thumbnail} 
                                alt={article.title} 
                                onClick={() => handleArticleClick(article.id)}
                                className="article-thumbnail"
                            />
                            )}
                            <div className="article-info">
                            <h3 onClick={() => handleArticleClick(article.id)}>{article.title}</h3>
                            <p className="article-excerpt">
                                {article.content.substring(0, 150)}...
                            </p>
                            <div className="article-meta">
                                <span>By {article.author}</span>
                                <span>{article.reads || 0} reads</span>
                                <span>{article.likes || 0} likes</span>
                            </div>
                            <div className="article-tags">
                                {article.tags?.map((tag, index) => (
                                <span key={index} className="tag">{tag}</span>
                                ))}
                            </div>
                            </div>
                        </div>
                        ))
                    ) : (
                        <div className="no-articles">No articles found</div>
                    )}
                    </div>
                )}
                </div>
            );
            };

            export default YasaNews;
        </script>
    </body>
</html>
